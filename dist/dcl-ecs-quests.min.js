"use strict";var __decorate=this&&this.__decorate||function(e,r,o,i){var s,f=arguments.length,l=f<3?r:null===i?i=Object.getOwnPropertyDescriptor(r,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,r,o,i);else for(var d=e.length-1;d>=0;d--)(s=e[d])&&(l=(f<3?s(l):f>3?s(r,o,l):s(r,o))||l);return f>3&&l&&Object.defineProperty(r,o,l),l},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var r,o=1,i=arguments.length;o<i;o++)for(var s in r=arguments[o])Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e}).apply(this,arguments)},__awaiter=this&&this.__awaiter||function(e,r,o,i){return new(o||(o=Promise))((function(s,f){function fulfilled(e){try{step(i.next(e))}catch(e){f(e)}}function rejected(e){try{step(i.throw(e))}catch(e){f(e)}}function step(e){var r;e.done?s(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(fulfilled,rejected)}step((i=i.apply(e,r||[])).next())}))},__generator=this&&this.__generator||function(e,r){var o,i,s,f,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return f={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function verb(f){return function(d){return function(f){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(s=2&f[0]?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[2&f[0],s.value]),f[0]){case 0:case 1:s=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,i=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(!((s=(s=l.trys).length>0&&s[s.length-1])||6!==f[0]&&2!==f[0])){l=0;continue}if(3===f[0]&&(!s||f[1]>s[0]&&f[1]<s[3])){l.label=f[1];break}if(6===f[0]&&l.label<s[1]){l.label=s[1],s=f;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(f);break}s[2]&&l.ops.pop(),l.trys.pop();continue}f=r.call(e,l)}catch(e){f=[6,e],i=0}finally{o=s=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,d])}}},__createBinding=this&&this.__createBinding||(Object.create?function(e,r,o,i){void 0===i&&(i=o),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[o]}})}:function(e,r,o,i){void 0===i&&(i=o),e[i]=r[o]}),__exportStar=this&&this.__exportStar||function(e,r){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||__createBinding(r,e,o)};define("dcl-quests-client/quests-client-amd",(function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(e){var r={exports:{}};return e(r,r.exports),r.exports}var r=n((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.fromBase64=r.toBase64=void 0;var o="function"==typeof btoa?btoa:function(e){return Buffer.from(e).toString("base64")},i="function"==typeof atob?atob:function(e){return Buffer.from(e,"base64").toString("utf-8")};r.toBase64=function(e){return o(e)},r.fromBase64=function(e){return i(e)}})),o=n((function(e,o){function n(e){return e.split("").reverse().join("")}Object.defineProperty(o,"__esModule",{value:!0}),o.DefObf=void 0,o.DefObf=new(function(){function t(){}return t.prototype.obf=function(e){return n(r.toBase64(e)).replace(/=/g,"_")},t.prototype.deobf=function(e){return r.fromBase64(n(e.replace(/_/g,"=")))},t}())})),i=n((function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.AUTH_METADATA_HEADER=r.AUTH_TIMESTAMP_HEADER=r.AUTH_CHAIN_HEADER_PREFIX=void 0,r.AUTH_CHAIN_HEADER_PREFIX="x-identity-auth-chain-",r.AUTH_TIMESTAMP_HEADER="x-identity-timestamp",r.AUTH_METADATA_HEADER="x-identity-metadata"})),s=n((function(e,r){var o,i;Object.defineProperty(r,"__esModule",{value:!0}),r.Visibility=r.ProgressStatus=void 0,(o=r.ProgressStatus||(r.ProgressStatus={})).BLOCKED="blocked",o.NOT_STARTED="not_started",o.ON_GOING="on_going",o.COMPLETED="completed",o.FAILED="failed",(i=r.Visibility||(r.Visibility={})).VISIBLE="visible",i.VISIBLE_IF_CAN_START="visible_if_can_start",i.SECRET="secret"})),f=n((function(r,f){var l=e&&e.__createBinding||(Object.create?function(e,r,o,i){void 0===i&&(i=o),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[o]}})}:function(e,r,o,i){void 0===i&&(i=o),e[i]=r[o]}),d=e&&e.__exportStar||function(e,r){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||l(r,e,o)};Object.defineProperty(f,"__esModule",{value:!0}),d(o,f),d(i,f),d(s,f)})),l=n((function(r,o){var i=e&&e.__awaiter||function(e,r,o,i){return new(o||(o=Promise))((function(s,f){function u(e){try{c(i.next(e))}catch(e){f(e)}}function a(e){try{c(i.throw(e))}catch(e){f(e)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(u,a)}c((i=i.apply(e,r||[])).next())}))},s=e&&e.__generator||function(e,r){var o,i,s,f,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return f={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function a(f){return function(d){return function(f){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(s=2&f[0]?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[2&f[0],s.value]),f[0]){case 0:case 1:s=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,i=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(!((s=(s=l.trys).length>0&&s[s.length-1])||6!==f[0]&&2!==f[0])){l=0;continue}if(3===f[0]&&(!s||f[1]>s[0]&&f[1]<s[3])){l.label=f[1];break}if(6===f[0]&&l.label<s[1]){l.label=s[1],s=f;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(f);break}s[2]&&l.ops.pop(),l.trys.pop();continue}f=r.call(e,l)}catch(e){f=[6,e],i=0}finally{o=s=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,d])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.flatFetch=void 0,o.flatFetch=function(e,r){return i(this,void 0,void 0,(function(){var o,i,f,l,d,p;return s(this,(function(s){switch(s.label){case 0:return[4,fetch(e,r)];case 1:switch(o=s.sent(),i=(null==r?void 0:r.responseBodyType)||"text",f={},o.headers.forEach((function(e,r){return f[r]=e})),l={ok:o.ok,status:o.status,statusText:o.statusText,headers:f},i){case"json":return[3,2];case"text":return[3,4]}return[3,6];case 2:return d=l,[4,o.json()];case 3:return d.json=s.sent(),[3,6];case 4:return p=l,[4,o.text()];case 5:return p.text=s.sent(),[3,6];case 6:return[2,l]}}))}))}})),d=n((function(r,o){var i=e&&e.__assign||function(){return(i=Object.assign||function(e){for(var r,o=1,i=arguments.length;o<i;o++)for(var s in r=arguments[o])Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e}).apply(this,arguments)},s=e&&e.__awaiter||function(e,r,o,i){return new(o||(o=Promise))((function(s,f){function u(e){try{c(i.next(e))}catch(e){f(e)}}function a(e){try{c(i.throw(e))}catch(e){f(e)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(u,a)}c((i=i.apply(e,r||[])).next())}))},d=e&&e.__generator||function(e,r){var o,i,s,f,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return f={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function a(f){return function(d){return function(f){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(s=2&f[0]?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[2&f[0],s.value]),f[0]){case 0:case 1:s=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,i=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(!((s=(s=l.trys).length>0&&s[s.length-1])||6!==f[0]&&2!==f[0])){l=0;continue}if(3===f[0]&&(!s||f[1]>s[0]&&f[1]<s[3])){l.label=f[1];break}if(6===f[0]&&l.label<s[1]){l.label=s[1],s=f;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(f);break}s[2]&&l.ops.pop(),l.trys.pop();continue}f=r.call(e,l)}catch(e){f=[6,e],i=0}finally{o=s=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,d])}}};function u(e,r,o,i){var s={},l=Date.now(),d=JSON.stringify(o);return i([e.toLowerCase(),r.toLowerCase(),l.toString(),d].join(":").toLowerCase()).forEach((function(e,r){s[""+f.AUTH_CHAIN_HEADER_PREFIX+r]=JSON.stringify(e)})),s[f.AUTH_TIMESTAMP_HEADER]=l.toString(),s[f.AUTH_METADATA_HEADER]=d,s}Object.defineProperty(o,"__esModule",{value:!0}),o.authFetch=void 0,o.authFetch=function(e){return function(r,o){var f,p;return s(this,void 0,void 0,(function(){var s,h;return d(this,(function(d){return s=new URL(r).pathname,h=i(i({},o),{headers:i(i({},u(null!==(f=null==o?void 0:o.method)&&void 0!==f?f:"get",s,null!==(p=null==o?void 0:o.metadata)&&void 0!==p?p:{},e)),null==o?void 0:o.headers),responseBodyType:"text"}),[2,l.flatFetch(r,h)]}))}))}}})),p=n((function(r,o){var i=e&&e.__assign||function(){return(i=Object.assign||function(e){for(var r,o=1,i=arguments.length;o<i;o++)for(var s in r=arguments[o])Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e}).apply(this,arguments)},s=e&&e.__awaiter||function(e,r,o,i){return new(o||(o=Promise))((function(s,f){function u(e){try{c(i.next(e))}catch(e){f(e)}}function a(e){try{c(i.throw(e))}catch(e){f(e)}}function c(e){var r;e.done?s(e.value):(r=e.value,r instanceof o?r:new o((function(e){e(r)}))).then(u,a)}c((i=i.apply(e,r||[])).next())}))},p=e&&e.__generator||function(e,r){var o,i,s,f,l={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return f={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function a(f){return function(d){return function(f){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(s=2&f[0]?i.return:f[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,f[1])).done)return s;switch(i=0,s&&(f=[2&f[0],s.value]),f[0]){case 0:case 1:s=f;break;case 4:return l.label++,{value:f[1],done:!1};case 5:l.label++,i=f[1],f=[0];continue;case 7:f=l.ops.pop(),l.trys.pop();continue;default:if(!((s=(s=l.trys).length>0&&s[s.length-1])||6!==f[0]&&2!==f[0])){l=0;continue}if(3===f[0]&&(!s||f[1]>s[0]&&f[1]<s[3])){l.label=f[1];break}if(6===f[0]&&l.label<s[1]){l.label=s[1],s=f;break}if(s&&l.label<s[2]){l.label=s[2],l.ops.push(f);break}s[2]&&l.ops.pop(),l.trys.pop();continue}f=r.call(e,l)}catch(e){f=[6,e],i=0}finally{o=s=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:!0}}([f,d])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.QuestsClient=void 0;var h=function(){function t(e){var r;this.options=e,this.obf=f.DefObf,e.authChainProvider?this.fetchFn=d.authFetch(e.authChainProvider):this.fetchFn=null!==(r=e.fetchFn)&&void 0!==r?r:l.flatFetch}return t.prototype.urlFor=function(e){return""+this.options.baseUrl+e},t.prototype.fetch=function(e,r){return s(this,void 0,void 0,(function(){var o,f=this;return p(this,(function(l){return(null==r?void 0:r.bodyObject)&&(r.body=JSON.stringify(r.bodyObject),r.obf?(r.body=this.obf.obf(r.body),r.headers=i(i({},r.headers),{"Content-Type":"application/quests"})):r.headers=i(i({},r.headers),{"Content-Type":"application/json"})),o=i(i({},r),{metadata:this.options.metadata,responseBodyType:"text"}),[2,this.fetchFn(this.urlFor(e),o).then((function(e){return s(f,void 0,void 0,(function(){var o,i;return p(this,(function(s){return o=e.text||"",(null==r?void 0:r.deobf)&&e.ok&&(o=this.obf.deobf(o)),i=function(e){try{return JSON.parse(e)}catch(r){return e}}(o),[2,{ok:e.ok,status:e.status,body:i}]}))}))}))]}))}))},t.prototype.getQuests=function(){return s(this,void 0,void 0,(function(){return p(this,(function(e){return[2,this.fetch("/quests")]}))}))},t.prototype.getQuestDetails=function(e){return s(this,void 0,void 0,(function(){return p(this,(function(r){return[2,this.fetch("/quests/"+e)]}))}))},t.prototype.startQuest=function(e){return s(this,void 0,void 0,(function(){return p(this,(function(r){return[2,this.fetch("/s/"+this.obf.obf(e),{method:"post",deobf:!0})]}))}))},t.prototype.updateArbitraryState=function(e,r){return s(this,void 0,void 0,(function(){return p(this,(function(o){return[2,this.fetch("/kv/"+this.obf.obf(e),{method:"put",deobf:!0,obf:!0,bodyObject:r})]}))}))},t.prototype.makeProgress=function(e,r,o){return s(this,void 0,void 0,(function(){return p(this,(function(i){return[2,this.fetch("/p/"+this.obf.obf(e)+"/"+this.obf.obf(r),{method:"post",deobf:!0,obf:!0,bodyObject:o})]}))}))},t}();o.QuestsClient=h}));return function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(n((function(r,o){var i=e&&e.__createBinding||(Object.create?function(e,r,o,i){void 0===i&&(i=o),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[o]}})}:function(e,r,o,i){void 0===i&&(i=o),e[i]=r[o]}),f=e&&e.__exportStar||function(e,r){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||i(r,e,o)};Object.defineProperty(o,"__esModule",{value:!0}),f(p,o),f(s,o)})))})),define("types",["require","exports"],(function(e,r){Object.defineProperty(r,"__esModule",{value:!0})})),define("component",["require","exports"],(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.QuestTrackingInfo=void 0;var o=function(){function QuestTrackingInfo(e){this.questData=e}return QuestTrackingInfo.prototype.toJSON=function(){return this.questData},__decorate([Component("engine.questTrackingComponent",1417815519)],QuestTrackingInfo)}();r.QuestTrackingInfo=o})),define("mappings",["require","exports"],(function(e,r){function toRendererSections(e){var r=e.reduce((function(e,r){var o,i,s=null!==(o=r.section)&&void 0!==o?o:"",f=null!==(i=e[s])&&void 0!==i?i:{id:s,name:s,progress:0,tasks:[]};return f.tasks.push(function(e){return{id:e.id,progress:e.progressPercentage,name:e.description,coordinates:e.coordinates,payload:JSON.stringify(getProgressPayload(e)),status:e.progressStatus,type:e.progressMode.type}}(r)),e[s]=f,e}),{}),o=[];for(var i in r){var s=r[i];s.progress=s.tasks.length>0?s.tasks.reduce((function(e,r){return e+r.progress}),0)/s.tasks.length:0,o.push(s)}return o}function getProgressPayload(e){var r,o,i=e.progressMode;switch(i.type){case"single":return{isDone:"completed"===e.progressStatus};case"numeric":return{type:"numeric",start:i.start,end:i.end,current:null!==(o=null===(r=e.progressSummary)||void 0===r?void 0:r.current)&&void 0!==o?o:i.start};case"step-based":return{}}}Object.defineProperty(r,"__esModule",{value:!0}),r.toRendererQuest=void 0,r.toRendererQuest=function(e){return{id:e.id,name:e.name,description:e.description,icon:e.icon,thumbnail_banner:e.thumbnailBanner,thumbnail_entry:e.thumbnailEntry,status:e.progressStatus,sections:toRendererSections(e.tasks)}}})),define("RemoteQuestTracker",["require","exports","dcl-quests-client/quests-client-amd","@decentraland/SignedFetch","component","mappings"],(function(e,r,o,i,s,f){Object.defineProperty(r,"__esModule",{value:!0}),r.RemoteQuestTracker=void 0;var l={clientFactory:function(){return new o.QuestsClient({baseUrl:"https://quests-api.decentraland.io",fetchFn:i.signedFetch})},logErrors:!0,addToEngine:!0},d=function(){function RemoteQuestTracker(e,r){this.questId=e,this.options=__assign(__assign({},l),null!=r?r:{}),this.client=this.options.clientFactory(),this.entity=new Entity,this.options.addToEngine&&engine.addEntity(this.entity),this.refresh()}return RemoteQuestTracker.prototype.refresh=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(r){return[2,this.updateQuest(this.makeRequest((function(){return e.client.getQuestDetails(e.questId)})))]}))}))},RemoteQuestTracker.prototype.startQuest=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(r){return[2,this.updateQuest(this.makeRequest((function(){return e.client.startQuest(e.questId)})))]}))}))},RemoteQuestTracker.prototype.makeProgress=function(e,r){return __awaiter(this,void 0,void 0,(function(){var o=this;return __generator(this,(function(i){return[2,this.updateQuest(this.makeRequest((function(){return o.client.makeProgress(o.questId,e,r)})))]}))}))},RemoteQuestTracker.prototype.updateArbitraryState=function(e){return __awaiter(this,void 0,void 0,(function(){var r=this;return __generator(this,(function(o){return[2,this.updateQuest(this.makeRequest((function(){return r.client.updateArbitraryState(r.questId,e)})))]}))}))},RemoteQuestTracker.prototype.getCurrentStatePromise=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){return this.currentStatePromise?[2,this.currentStatePromise]:[2]}))}))},RemoteQuestTracker.prototype.getCurrentState=function(){return this.currentState},RemoteQuestTracker.prototype.makeRequest=function(e){return __awaiter(this,void 0,void 0,(function(){var r;return __generator(this,(function(o){switch(o.label){case 0:return[4,e()];case 1:return(r=o.sent()).ok||this.options.logErrors&&log("Error performing request on quest with id: "+this.questId+". Status: "+r.status,{body:r.body}),[2,r]}}))}))},RemoteQuestTracker.prototype.updateQuest=function(e){return __awaiter(this,void 0,void 0,(function(){var r,o;return __generator(this,(function(i){switch(i.label){case 0:return this.currentStatePromise=e.then((function(e){if(e.ok)return e.body;throw new Error("Could not get quest state. Status: "+e.status+". Body: "+e.body)})),[4,e];case 1:return(r=i.sent()).ok&&(this.currentState=r.body,(o=this.entity.getComponentOrNull(s.QuestTrackingInfo))?o.questData=f.toRendererQuest(this.currentState):this.entity.addComponent(new s.QuestTrackingInfo(f.toRendererQuest(this.currentState)))),[2,r]}}))}))},RemoteQuestTracker}();r.RemoteQuestTracker=d})),define("dcl-ecs-quests",["require","exports","component","mappings","types","RemoteQuestTracker"],(function(e,r,o,i,s,f){Object.defineProperty(r,"__esModule",{value:!0}),__exportStar(o,r),__exportStar(i,r),__exportStar(s,r),__exportStar(f,r)}));